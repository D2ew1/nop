<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	</head>
	<script src="js/jquery-3.4.1.js"></script>
	<body>
		<div id="app">
			<el-table :data="tableData" style="width: 100%" @selection-change="handleSelectionChange">
				<el-table-column type="selection">
				</el-table-column>
				<el-table-column prop="type" label="字典类型" width="180">
				</el-table-column>
				<el-table-column prop="describe" label="用途描述" width="180">
				</el-table-column>
				<el-table-column prop="code" label="编码">
				</el-table-column>
				<el-table-column prop="cvalue" label="编码值">
				</el-table-column>
				<el-table-column label="操作">
					<template slot-scope="scope">
						<el-button type="primary" icon="el-icon-setting" @click="handleEdit(scope.$index,true)"></el-button>
					</template>
				</el-table-column>
			</el-table>
			<el-button type="primary" icon="el-icon-edit" @click="handleEdit(0,false)"></el-button>
			<el-button type="primary" icon="el-icon-delete"></el-button>
			<div class="update">
				<el-dialog title="数据字典" :visible.sync="dialogVisible">
					<el-form ref="form" :model="form" label-width="80px" @>
						<el-form-item label="字典类型" prop="type" :rules="[
      						{ required: true, message: '字典类型不能为空'},
      						{ max: 20, message: '字典类型不超过20个字符'}
    					]">
							<el-input v-model="form.type" placeholder="请输入字典类型,不大于20个字符"></el-input>
						</el-form-item>
						<el-form-item label="用途描述" prop="describe" :rules="[
      						{ required: true, message: '数据描述不能为空'},
      						{ max: 20, message: '数据描述不超过20个字符'}
    					]">
							<el-input v-model="form.describe" placeholder="请输入数据描述,不大于20个字符"></el-input>
						</el-form-item>
						<el-form-item label="编码" prop="code" :rules="[
      						{ required: true, message: '编码不能为空'},
      						{ type: 'number', message: '输入数字'}
    					]">

							<el-input v-model.number="form.code" type="number" placeholder="请输入编码,0-9"></el-input>
						</el-form-item>
						<el-form-item label="编码值" prop="cvalue" :rules="[
      						{ required: true, message: '编码值不能为空'},
      						{ max: 10, message: '编码值不超过10个字符'}
    					]">
							<el-input v-model="form.cvalue" placeholder="请输入编码值,不大于10个字符"></el-input>
						</el-form-item>
						<el-form-item>
							<el-button @click="dialogVisible = false">取 消</el-button>
							<el-button type="primary" @click="onSubmit">确 定</el-button>
						</el-form-item>
						</el-from>
				</el-dialog>
			</div>

		</div>
		<!-- import Vue before Element -->
		<script src="https://unpkg.com/vue/dist/vue.js"></script>
		<!-- import JavaScript -->
		<script src="https://unpkg.com/element-ui/lib/index.js"></script>
		<script>
			new Vue({
				el: '#app',
				data: function() {
					return {
						tableData: [{
							type: 'SEX',
							describe: '性别',
							code: '0',
							cvalue: '男'
						}, {
							type: 'SEX',
							describe: '性别',
							code: '1',
							cvalue: '女'
						}],
						dialogVisible: false,
						isEdit: false,
						form: {
							type: '',
							describe: '',
							code: 0,
							cvalue: ''
						}
					}
				},
				methods: {
					handleSelectionChange(val) {
						if(val.length != 0)
							console.log(val[0].date)
					},
					handleEdit(row, isEdit) {
						//修改
						if(isEdit) {
							this.form.type = this.tableData[row].type;
							this.form.describe = this.tableData[row].describe;
							this.form.code = this.tableData[row].code;
							this.form.cvalue = this.tableData[row].cvalue;
							this.isEdit = isEdit;
						}
						//新增
						else {
							this.form.type = '';
							this.form.describe = '';
							this.form.code = '';
							this.form.cvalue = '';
							this.isEdit = isEdit;
						}
						this.dialogVisible = true;
					},
					onSubmit() {
						//更新提交
						if(this.isEdit) {
							$.ajax({
								type: "POST",
								url: "/updateDictionary",
								contentType: "application/json; charset=utf-8",
								data: JSON.stringify(this.form),
								dataType: "json",
								success: function(data) {
									//成功信息
									console.log("success")
								},
								error: function(message) {
									//失败信息
									console.log("error")
								}
							});
						}
						//新增提交
						else {
							this.$reqs.post("/addDictionary", this.form, config).then(function(result) {
								console.log(result);
							})
						}
					}

				}
			})
		</script>
	</body>

</html>